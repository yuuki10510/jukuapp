<h1>成績一覧</h1>

<% @students.each do |student| %>
  <h2><%= student.name %></h2>

  <% scores = student.scores %>
  <% subjects = Score.subjects.keys %>
  <% grouped_scores = scores.group_by { |s| [s.term, s.test_type] } %>

  <% if grouped_scores.any? %>
    <table border="1" cellpadding="6">
      <tr>
        <th>学期 / 教科</th>
        <% subjects.each do |subject| %>
          <th><%= I18n.t("activerecord.enums.score.subject.#{subject}") %></th>
        <% end %>
      </tr>

      <% grouped_scores.each do |(term, test_type), list| %>
        <tr>
          <td>
            <%= I18n.t("activerecord.enums.score.term.#{term}") %><br>
            （<%= I18n.t("activerecord.enums.score.test_type.#{test_type}") %>）
          </td>

          <% subjects.each do |subject| %>
            <% score = list.find { |s| s.subject == subject } %>
            <td><%= score&.score || "–" %></td>
          <% end %>
        </tr>
      <% end %>
    </table>
  <% else %>
    <p>まだ成績が登録されていません。</p>
  <% end %>

<hr>

<h3>成績推移（合計点）</h3>

<h4>棒グラフ（テスト別 合計点）</h4>

<%= bar_chart @line_chart_data_by_student[student.id],
      xtitle: "テスト",
      ytitle: "合計点",
      min: 0,
      max: 500,
      height: "400px" %>

<hr>

<h4>折れ線グラフ（推移）</h4>

<%= line_chart @line_chart_data_by_student[student.id],
      xtitle: "テスト",
      ytitle: "合計点",
      min: 0,
      max: 500,
      curve: false,
      height: "400px" %>
      
  <hr>
<% end %>
