<h3>成績一覧</h3>

<p>
  <%= link_to "成績入力",
        new_admin_student_score_path(@student),
        class: "btn" %>
</p>

<% subjects = Score.subjects.keys %>

<% grouped_scores =
     @scores.group_by { |s| [s.term, s.test_type] } %>

<table border="1" cellpadding="6">
  <tr>
    <th>学期 / 教科</th>
    <% subjects.each do |subject| %>
      <th><%= I18n.t("activerecord.enums.score.subject.#{subject}") %></th>
    <% end %>
    <th>操作</th>
  </tr>

  <% grouped_scores.each do |(term, test_type), scores| %>
    <tr>
      <td>
        <%= I18n.t("activerecord.enums.score.term.#{term}") %><br>
        （<%= I18n.t("activerecord.enums.score.test_type.#{test_type}") %>）
      </td>

      <% subjects.each do |subject| %>
        <% score = scores.find { |s| s.subject == subject } %>
        <td>
          <%= score ? score.score : "–" %>
        </td>
      <% end %>

      <td>
        <%= link_to "編集",
              admin_student_edit_test_scores_path(
                @student,
                term: term,
                test_type: test_type
              ) %>
      </td>
    </tr>
  <% end %>
</table>
